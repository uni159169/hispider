<html>
    <head>
        <title>Hitask Monitor</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
            body{margin:0px;}
            #treebody{position:absolute;background-color:#ffffff;
               border:1px solid #81BEF7;left:10px;top:10px;}
            .treeline{border:0px;font-size:12pt;font-weight:bold;color:#BDBDBD;}
            .title{border:0px;font-size:12pt;background-color:#ffffff;color:#000000;}
            .btitle{border:0px;font-size:12pt;background-color:#F2F2F2;}
            .node
            {
                overflow:hidden;
                color:black;
                font-size:12pt;
            }
            .editor
            {
                display:inline;
                color:blue;
                font-size:10pt;
                cursor:pointer;
            }
            .icon
            {
                display:inline;
                color:#A4A4A4;
                font-size:12pt;
                text-align:center;
                cursor:pointer;
            }
            .nchilds
            {
                display:inline;
                color:red;
                font-size:12pt;
                font-weight:bolder;
            }

        </style>
    <script language='javascript'>
    function FindArr(arr, v)
    {
        var i = 0;
        do
        {
            if(arr[i] == v) 
            return i;
        }while(++i < arr.length);
        return -1;
    }
    function DelArr(arr, v)
    {
        var i = 0;
        do
        {
            if(arr[i] == v) 
            {
                arr.splice(i, 1);
                return i;
            }
        }while(++i < arr.length);
        return -1;
    }
    function ReplaceArr(arr, v, newv)
    {
        var i = 0;
        do
        {
            if(arr[i] == v) 
            {
                arr[i] = newv;
                return i;
            }
        }while(++i < arr.length);
        return -1;
    }
    function highlight(obj)
    {
        obj.className = "btitle";
    }
    function backcss(obj)
    {
        obj.className = "title";
    }
    xtree = function(rootid)
    {
        this.TreeNodeNum = 0;
        this.TreeList = new Array();
        this.Root = document.getElementById(rootid);
        //add node
        this.Add = function(pid, name)
        {
            var pnode = null;
            var node = new Array();
            var id = -1;
            if(pid >= 0) pnode = this.TreeList[pid];
            if(pnode == null || pnode[0] == 0 || (pnode[0] > 0 && FindArr(pnode[4], name) == -1))
            {
                node[0] = 0;
                node[1] = pid;
                if(pnode)node[2] = pnode[2] + 1;
                else node[2] = 0;
                node[3] = name;
                node[4] = new Array();
                node[5] = new Array();
                this.TreeList.push(node);
                id = (this.TreeNodeNum)++;
                if(pnode)
                {
                    pnode[4].push(name);
                    pnode[5].push(id);
                    pnode[0]++;
                }
            }
            return id;
        }

        //remove node
        this.Remove = function(cid)
        {
            var node = false;
            var pnode = false;
            var i = 0, pid = 0;

            if((node = this.TreeList[cid]))
            {
                if((pid = node[1]) && (pnode = this.TreeList[pid]))
                {
                    DelArr(pnode[4], node[3]);
                    DelArr(pnode[5], cid);
                    pnode[0]--;
                }
                for(i = 0; i < node[0]; i++)
                {
                    this.Remove(node[0][i]);
                }
                this.TreeList[cid] = "";
            }
        }
        //update 
        this.Update = function(cid, name)
        {
            var node = false;
            var pnode = false;
            var pid = 0;

            if((node = this.TreeList[cid]))
            {
                if((pid = node[1]) && (pnode = this.TreeList[pid]))
                {
                    ReplaceArr(pnode[4], node[3], name);
                }
                node[3] = name;
            }
        }
        //add node
        this.AddNode = function(pid, id, name)
        {
            if(document.getElementById('node'+id)) return;
            var oParent = null;
            if(pid >= 0)
            {
                oParent = document.getElementById("node"+pid);
            }
            else
            {
                oParent = this.Root;//document.getElementById(this.RootId);
            }
            if(oParent == null) return;
            var oNode = document.createElement('div');
            var level = oParent.getAttribute('level') * 1;
            var nchilds = oParent.getAttribute('nchilds') * 1;
            oParent.setAttribute('nchilds', nchilds + 1);
            var ofold = null;
            if(nchilds == 0 && (ofold = document.getElementById('fold_'+pid)))
            {
                ofold.innerHTML = '▼';
            }
            var onchilds = null;
            if((onchilds = document.getElementById('ch_'+pid)))
            {
                onchilds.innerHTML = nchilds+1;
            }
            oNode.id = "node" + id;
            oNode.className = 'node';
            oNode.setAttribute('level', level + 1);
            oNode.setAttribute('nchilds', 0);
            htmlstr = "<div id='title_"+ id +"' class='title' ";
            htmlstr += " onmousemove='highlight(this);' onmouseout='backcss(this);'>";
            htmlstr += "<span class='treeline'>";
            var i = 0;
            for(i = 0; i < (level-1); i++)
            {
                htmlstr += "&nbsp;&nbsp;&nbsp;";
                htmlstr += "┊";
            }
            if(level > 0)
            {
                htmlstr += "&nbsp;&nbsp;&nbsp;";
            }
            htmlstr += "</span>";
            htmlstr += "<span id='fold_"+ id +"' class='icon' onclick='Fold(this)'>►</span>";
            htmlstr += "&nbsp;&nbsp;";
            htmlstr += "<span id='nd_"+id+"' class='nd_name'>"+name+"</span>";
            htmlstr += "[<span id='ch_"+ id +"' class='nchilds' >0</span>]";
            htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
            htmlstr += "<span class='editor' title='Add' onclick='AddChild(this)'>✚</span>";
            htmlstr += "&nbsp;&nbsp;&nbsp;";
            htmlstr += "<span class='editor' title='Delete' onclick='DeleteNode(this)'>✘</span>";
            htmlstr += "&nbsp;&nbsp;&nbsp;";
            htmlstr += "<span class='editor' title='Rename' onclick='EditNode(this)'>✎</span>";
            htmlstr += "&nbsp;&nbsp;&nbsp;";
            htmlstr += "</div>\r\n";
            oNode.innerHTML = htmlstr; 
            oParent.appendChild(oNode);
        }

        //drop node
        this.DropNode = function(id)
        {
            this.Remove(id);
            var oNode = document.getElementById("node"+id);
            oNode.innerHTML = ""; 
        }
        //init root
        this.init = function(name)
        {
            this.AddNode(-1, 0, name);
        }
    }
    function Fold(element)
    {
        var nchilds = element.parentNode.parentNode.getAttribute('nchilds') * 1;
        if(element.innerHTML == '✚')
        {
            element.parentNode.parentNode.style.height = '';
            if(nchilds > 0)element.innerHTML = '▼';
        }
        else
        {
            element.parentNode.parentNode.style.height = element.parentNode.offsetHeight;
            if(nchilds > 0) element.innerHTML = '✚';
        }
    }
    </script>
    </head>
    <body>
    <form action="#" ><div id='treebody' level='0'></div></form>
    <script language='javascript'>
    var dxtree = new xtree('treebody');
    dxtree.init("root");
    var i = 0, j = 0, k = 0; x = 0, z = 0;
    for(i = 1; i < 10; i++)
    {
        dxtree.AddNode(0, i, "node"+i);
        for(j = 0; j < 10; j++)
        {
            x = i * 10 + j;
            dxtree.AddNode(i, x, "node" + x);
            for(k = 0; k < 10; k++)
            {
                z = k * 100 + i * 10 + k;
                dxtree.AddNode(x, z, "node" + z);
            }
        }
    }
    /*
    alert(document.getElementById('treebody').innerHTML);
    document.write("<pre>");
    document.write(dxtree.TreeList);
    document.write("</pre>");
    */
</script>
</body>
</html>
