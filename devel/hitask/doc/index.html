<html>
    <head>
        <title>Hitask Monitor</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
            body{
                background:#000000;
                color:#333;
                font-family:verdana,tahoma;
                font-size:12pt;
                margin:auto;
                width:1000px;
                height:675px;
            }
            #mainframe
            {
                position:absolute;
                background-color:#ffffff;
                margin:auto;
                width:1000px;
                height:675px;
            }
            #itab {position:absolute;background:#ffffff;height:50px; top:0px;left:0px;}
            #itab ul{margin:0;padding:0;list-style:none;color:#2F5FA1;}
            #itab li{float:left;background-color:#F4FBFF;border-right:1px solid #FFF;
                padding:3px 8px 3px 8px;cursor: pointer;width:120px;height:30px;}
            #itab .tab-selected{background-color:#D0E9F7;padding:0;margin:0;
                padding:3px 8px 3px 8px;height:30px;}
            #taskinfo{position:absolute;background-color:#000000; color:red;display:none;
                border:1px solid #81BEF7; padding:1px;top:36px;width:500px;}
            .ktask{font-size:12pt;font-weight:bold;}
            .vtask{font-size:12pt;font-weight:bold;}
            #database{position:absolute;background-color:#ffffff;display:none;
                border:1px solid #81BEF7; padding:0px;left:0px;top:36px;width:500px;}
            #dbtitle{position:absolute;top:0px;left:0px;padding:0px;
                background-color:#D0E9F7;height:20px;width:100%;}
            #dbselect{position:absolute;top:20px;width:200px;}
            .ultab{list-style:none;padding:0;margin:0;}
            .ltabname{cursor: pointer;}
            .ltab{background:#F4FBFF;cursor: pointer;}
            .ltab-selected{background:#D0E9F7;cursor: pointer;}
            #dbfields{position:absolute;left:200px;top:30px;}
            #dbfieldform{position:absolute;width:450px;background-color:#ffffff;
                border:1px solid #81BEF7;padding:0px;overflow:auto;display:none;}
            #treebody{position:absolute;background-color:#ffffff;display:none;
                border:1px solid #81BEF7; padding:1px;left:0px;top:36px;width:100%;}
            .formdiv{position:absolute;width:200px;background-color:#ffffff;
                border:1px solid #81BEF7;padding:10px;overflow:auto;display:none;}
            .formclose{font-size:14pt;font-weight:100;color:silver;cursor:pointer;display:inline;}
            .treeline{border:0px;font-size:12pt;font-weight:bold;color:#BDBDBD;}
            .title{border:0px;font-size:12pt;background-color:#ffffff;color:#000000;}
            .btitle{border:0px;font-size:12pt;background-color:#F2F2F2;}
            .node
            {
                overflow:hidden;
                color:black;
                font-size:12pt;
            }
            .eadd
            {
                color:#5FB404;
                font-size:13pt;
                font-weight:bolder;
                cursor:pointer;
            }
            .eupdate
            {
                color:#FF8000;
                font-size:13pt;
                font-weight:bolder;
                cursor:pointer;
            }
            .edelete
            {
                color:#B4045F;
                font-size:13pt;
                font-weight:bolder;
                cursor:pointer;
            }
            .icon
            {
                display:inline;
                color:#FF8000;
                font-size:12pt;
                text-align:center;
                cursor:pointer;
            }
            .nchilds
            {
                display:inline;
                color:red;
                font-size:12pt;
            }

        </style>
        <script language='javascript'>
            function trim(str)
            {
                return str.replace(/(^\s+|\s+$)/, "");
            }
            function highlight(obj)
            {
                obj.className = "btitle";
            }
            function backcss(obj)
            {
                obj.className = "title";
            }
            function CreateXMLHTTP()
            {
                var xmlhttp = null;
                try{
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                    as = 1;
                    }catch(e){
                    try{
                        xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
                        as = 1;
                        }catch(e){
                        try{
                            xmlhttp = new XMLHttpRequest();
                            as = 2;
                            }catch(e){
                            xmlhttp = null;
                            as = 0;
                        }
                    }
                }
                return xmlhttp;
            }
            function AddNode(pid, id, name, count)
            {
                if(document.getElementById("node"+id) != null) return;
                //alert("pid:"+pid+"id:"+id+"name:"+name);
                var oParent = null;
                if(pid >= 0)
                {
                    oParent = document.getElementById("node"+pid);
                }
                else
                {
                    oParent = document.getElementById('treebody');
                }
                if(oParent == null) return;
                var oNode = document.createElement('div');
                var level = oParent.getAttribute('level') * 1;
                var nchilds = oParent.getAttribute('nchilds') * 1;
                oParent.setAttribute('nchilds', nchilds + 1);
                var ofold = null;
                if((ofold = document.getElementById('fold_'+pid)))
                {
                    if(nchilds == 0) ofold.innerHTML = '▼'; 
                }
                var onchilds = null;
                if((onchilds = document.getElementById('ch_'+pid)))
                {
                    onchilds.innerHTML = nchilds+1;
                }
                oNode.id = "node" + id;
                oNode.className = 'node';
                oNode.setAttribute('level', level + 1);
                oNode.setAttribute('nchilds', 0);
                oNode.setAttribute('parent', pid);
                oNode.setAttribute('UID', id);
                oNode.setAttribute('UName', name);
                htmlstr = "<div id='title_"+ id +"' class='title' ";
                htmlstr += " onmousemove='highlight(this);' onmouseout='backcss(this);'>";
                htmlstr += "<span class='treeline'>";
                var i = 0;
                for(i = 0; i < (level-1); i++)
                {
                    htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;";
                }
                if(level > 0)
                {
                    htmlstr += "&nbsp;&nbsp;&nbsp;";
                }
                htmlstr += "</span>";
                if(count > 0)
                    htmlstr += "<span id='fold_"+ id +"' class='icon' onclick='Fold(this)'>✚</span>";
                else
                    htmlstr += "<span id='fold_"+ id +"' class='icon' onclick='Fold(this)'>►</span>";
                htmlstr += "&nbsp;&nbsp;";
                htmlstr += "<span id='nd_"+id+"' class='nd_name'>"+name+"</span>";
                htmlstr += "[<span id='ch_"+ id +"' class='nchilds' >"+count+"</span>]";
                htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                htmlstr += "<span class='eadd' title='Add' ";
                htmlstr += "onclick='XAdd(event)'>✚</span>";
                htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;";
                htmlstr += "<span class='eupdate' title='Rename' ";
                htmlstr += "onclick='XEdit(event)'>✎</span>";
                htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;";
                htmlstr += "<span class='edelete' title='Delete' ";
                htmlstr += "onclick='XDelete("+id+")'>✘</span>";
                htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;";
                htmlstr += "</div>\r\n";
                oNode.innerHTML = htmlstr; 
                oParent.appendChild(oNode);
            }
            function UpdateNode(id, name)
            {
                var oNode = document.getElementById('node'+id);
                if(oNode != null)
                {
                    oNode.setAttribute('UName', name);
                    var oName = document.getElementById('nd_'+id);
                    if(oName != null)
                    {
                        oName.innerHTML = name;
                    }
                }
            }
            function ListChilds(pid, url, argv)
            {
                var xmlHttp = CreateXMLHTTP();
                if(xmlHttp != null)
                {
                    xmlHttp.open('POST', url, true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                var tnode = eval(xmlHttp.responseText);
                                //alert(xmlHttp.responseText);
                                if(tnode['id'] == pid)
                                {
                                    var i = 0;
                                    for(i = 0; i < tnode['nchilds']; i++)
                                    {
                                        AddNode(pid, tnode['childs'][i]['id'] * 1, 
                                        tnode['childs'][i]['name'], 
                                        tnode['childs'][i]['nchilds']);
                                    }
                                }
                            }
                        }
                    }
                    xmlHttp.send(argv);
                }
            }
            //close form
            function CloseForm(element)
            {
                element.parentNode.parentNode.style.display = "none";
            }

            //Add child
            function XAdd(e)
            {
                e = e || window.event;
                var element = e.target || e.srcElement;
                var Xdiv =  document.getElementById("txtform");
                var x = e.clientX + document.body.scrollLeft;
                var y = e.clientY + document.body.scrollTop;
                Xdiv.style.left = x - 50;
                Xdiv.style.top = y + 10;
                Xdiv.style.display = 'inline';
                var form = document.forms["editorform"];
                form['op'].value = 'node_add';
                form['pid'].value = element.parentNode.parentNode.getAttribute('UID');
                form['nodeid'].value = '';
                form['nodename'].focus();
                form['nodename'].value = '';
            }
            function XEdit(e)
            {
                e = e || window.event;
                var element = e.target || e.srcElement;
                var Xdiv =  document.getElementById("txtform");
                var x = e.clientX;
                var y = e.clientY;
                Xdiv.style.left = x - 50;
                Xdiv.style.top = y + 10;
                Xdiv.style.display = 'inline';
                var form = document.forms["editorform"];
                form['op'].value = 'node_update';
                form['pid'].value = '';
                form['nodeid'].value = element.parentNode.parentNode.getAttribute('UID');
                form['nodename'].focus();
                form['nodename'].value = element.parentNode.parentNode.getAttribute('UName');
            }
            function HiddenEditor()
            {
                var div = document.getElementById('txtform');
                div.style.display = 'none';
                return true;
            }
            function EditNode(form)
            {
                var argv = "";
                var op = form['op'].value;
                var pid = form['pid'].value;
                var nodeid = form['nodeid'].value;
                var nodename = form['nodename'].value;
                if(op == 'node_add' && nodename && pid >= 0)
                {
                    argv = "op="+op+"&name="+encodeURIComponent(nodename)+"&parentid="+pid;
                }
                else if(op == 'node_update' && nodename)
                {
                    if(nodeid > 0)
                        argv = "op="+op+"&name="+encodeURIComponent(nodename)+"&nodeid="+nodeid;
                    else 
                    {
                        UpdateNode(nodeid, nodename);
                        return HiddenEditor();
                    }
                }
                else return ;
                //alert("op:"+op+"nodeid:"+nodeid+"pid:"+pid+"nodename:"+nodename);
                var xmlHttp = CreateXMLHTTP();
                if(xmlHttp != null)
                {
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                if(op == 'node_add')
                                {
                                    var tnode = eval(xmlHttp.responseText);
                                    if(tnode['id'] == pid)
                                    {
                                        var i = 0;
                                        for(i = 0; i < tnode['nchilds']; i++)
                                        {
                                            AddNode(pid, tnode['childs'][i]['id'] * 1, 
                                                tnode['childs'][i]['name'], 
                                            tnode['childs'][i]['nchilds']);
                                        }
                                    }
                                }
                                else if(op == 'node_update')
                                {
                                    var id = trim(xmlHttp.responseText);
                                    if(id > 0 && id == nodeid)
                                        UpdateNode(id, nodename);
                                }
                            }
                            
                        }
                    }
                    xmlHttp.send(argv);
                }
                return HiddenEditor();
            }

            //delete node
            function XDelete(nodeid)
            {
                var xmlHttp = null;
                var oNode = document.getElementById("node"+nodeid);
                var name = null;
                if(nodeid > 0 && oNode != null && (name = oNode.getAttribute('UName'))
                    && confirm('Are you sure delete node:'+nodeid+' name:'+name+' ?') 
                    && (xmlHttp = CreateXMLHTTP()) != null)
                {
                    var argv = "op=node_delete&nodeid="+nodeid;
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                var id = trim(xmlHttp.responseText);
                                var pid = oNode.getAttribute('parent');
                                if(id == nodeid)
                                {
                                    var oParent = document.getElementById('node'+pid);
                                    var nchilds = oParent.getAttribute('nchilds') - 1;
                                    oParent.setAttribute('nchilds', nchilds);
                                    var ochild =  document.getElementById('ch_'+pid);
                                    ochild.innerHTML = nchilds;
                                    oNode.innerHTML = ""; 
                                }
                            }
                            
                        }
                    }
                    xmlHttp.send(argv);
                }
            }
            //fold node
            function Fold(element)
            {
                var nchilds = element.parentNode.parentNode.getAttribute('nchilds') * 1;
                var uid = element.parentNode.parentNode.getAttribute('UID') * 1;
                var url = "/";
                var argv = "op=node_childs&nodeid="+uid;
                if(element.innerHTML == '✚')
                {
                    element.parentNode.parentNode.style.height = '';
                    ListChilds(uid, url, argv);
                    if(nchilds > 0)element.innerHTML = '▼';
                }
                else if(element.innerHTML == '►')
                {
                    ListChilds(uid, url, argv);
                }
                else
                {
                    element.parentNode.parentNode.style.height = element.parentNode.offsetHeight;
                    if(nchilds > 0) element.innerHTML = '✚';
                }
            }
            function ViewTask(op)
            {
                var xmlHttp = null;
                if((xmlHttp = CreateXMLHTTP()) != null)
                {
                    var argv = "op="+op;
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                var taskinfo = eval(xmlHttp.responseText);
                                if(taskinfo)
                                {
                                    var htmlstr = "";
                                    htmlstr += "<span class='ktask'>Running:&nbsp;</span>";
                                    htmlstr += "<a href=\"javascript:ViewTask('task_";
                                    htmlstr += taskinfo['status']+"');\" class='vtask'";
                                    htmlstr += ">"+taskinfo['status']+"</a><br>";
                                    htmlstr += "<span class='ktask'>Tasks:&nbsp;</span>";
                                    htmlstr += "<span class='vtask'>"+taskinfo['url_tasks'];
                                    htmlstr += "</span><br>";
                                    htmlstr += "<span class='ktask'>URL Total:&nbsp;</span>";
                                    htmlstr += "<span class='vtask'>"+taskinfo['url_total'];
                                    htmlstr += "</span><br>";
                                    htmlstr += "<span class='ktask'>URL OK:&nbsp;</span>";
                                    htmlstr += "<span class='vtask'>"+taskinfo['url_ok'];
                                    htmlstr += "</span><br>";
                                    htmlstr += "<span class='ktask'>URL Error:&nbsp;</span>";
                                    htmlstr += "<span class='vtask'>"+taskinfo['url_error'];
                                    htmlstr += "</span><br>";
                                    htmlstr += "<span class='ktask'>Doc:&nbsp;</span>";
                                    htmlstr += "<span class='vtask'>"+taskinfo['doc_total_zsize'];
                                    htmlstr += "/" + taskinfo['doc_total_size']+"</span><br>";
                                    htmlstr += "<span class='ktask'>Host:&nbsp;</span>";
                                    htmlstr += "<span class='vtask'>"+taskinfo['host_current'];
                                    htmlstr += "/" + taskinfo['host_total']+"</span><br>";
                                    htmlstr += "<span class='ktask'>Time Used:&nbsp;</span>";
                                    htmlstr += "<span class='vtask'>["+taskinfo['t_day'];
                                    htmlstr += "&nbsp;Day(s)&nbsp;&nbsp;"+taskinfo['t_hour'];
                                    htmlstr += ":"+taskinfo['t_min'];
                                    htmlstr += ":"+taskinfo['t_sec'];
                                    htmlstr += "&nbsp;+"+taskinfo['t_usec']+"]";
                                    htmlstr += "</span><br>";
                                    htmlstr += "<span class='ktask'>Speed:&nbsp;</span>";
                                    htmlstr += "<span class='vtask'>"+taskinfo['speed'];
                                    htmlstr += " (KB/S) </span>\n";
                                    var otaskinfo = document.getElementById('taskinfo');
                                    if(otaskinfo) otaskinfo.innerHTML = htmlstr;
                                }
                            }
                            
                        }
                    }
                    xmlHttp.send(argv);
                }
            }
            function selectTab(element)
            {
                element.className = 'ltab-selected';
            }
            function outTab(element)
            {
                element.className = 'ltab';
            }
            function ViewDB(txt)
            {
                var db = eval(txt);
                if(db && db['tables'].length > 0)
                {
                    var tabid = 0;
                    var tabname = "";
                    var htmlstr = "<ul class='ultab'>";
                    for(i = 0; i < db['tables'].length; i++)
                    {
                        tabid = db['tables'][i]['id'];
                        tabname = db['tables'][i]['name'];
                        htmlstr += "<li class='ltab' onmousemove='selectTab(this)' ";
                        htmlstr += " onmouseout='outTab(this)' >";
                        htmlstr += "<span class='ltabname' onclick='ViewTable("+tabid+")'>";
                        htmlstr += tabname+"</span>";
                        htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;";
                        htmlstr += "<span class='eupdate' title='Rename' ";
                        htmlstr += "onclick=\"DBXEdit(event,"+tabid+", '"+tabname+"')\">✎</span>";
                        htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;";
                        htmlstr += "<span class='edelete' title='Delete' ";
                        htmlstr += "onclick=\"DeleteTable("+tabid+", '"+tabname+"')\">✘</span>";
                        htmlstr += "</li>";
                    }
                    htmlstr += "</ul>";
                    var odb = document.getElementById('dbselect');
                    odb.innerHTML = htmlstr;
                }
                var odbf = document.getElementById('dbfields');
                odbf.innerHTML = "";
            }

            function AddTable(form)
            {
                var tabname = form['tabname'].value;
                var xmlHttp = null;
                if(tabname && (xmlHttp = CreateXMLHTTP()) != null)
                {
                    var argv = "op=table_add&name="+tabname;
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                ViewDB(xmlHttp.responseText);
                                form['tabname'].value = '';
                            }
                        }
                    }
                    xmlHttp.send(argv);
                }
                return true;
            }
            function DeleteTable(tabid, tabname)
            {
                if(confirm("Are you sure delete tabble:"+tabname+" ?") 
                    && (xmlHttp = CreateXMLHTTP()) != null)
                {
                    var argv = "op=table_delete&tableid="+tabid;
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                ViewDB(xmlHttp.responseText);
                            }
                        }
                    }
                    xmlHttp.send(argv);
                }
                return true;
            }
            //List Table Fields
            function ViewFields(txt)
            {
                var tab = eval(txt);
                if(tab)
                {
                    var tabid = tab['id'];
                    var tabname = tab['name'];
                    var fid = null;
                    var fname = null;
                    var ftype = null;
                    var flag = null;
                    htmlstr =  "<ul class='ultab' >";
                    htmlstr += "<span class='ltabname'>"+tabname+"["+tab['nfields']+"]</span>";
                    htmlstr += "<span class='eadd' title='Click Add New Field' ";
                    htmlstr += "onclick=\"DBFXAdd(event, '"+tabid+"')\">✚</span>";
                    for(i = 0; i < tab['nfields']; i++)
                    {
                        fid = tab['fields'][i]['id'];
                        fname = tab['fields'][i]['name'];
                        ftype = tab['fields'][i]['type'];
                        flag = tab['fields'][i]['flag'];
                        htmlstr += "<li><span class='lfield' >"+fname+"</span>";
                        htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;";
                        htmlstr += "<span class='eupdate' title='Change' ";
                        htmlstr += "onclick=\"DBFXEdit(event, "+tabid+","+fid+",";
                        htmlstr += "'"+fname+"', "+ftype+", "+flag+")\">✎</span>";
                        htmlstr += "&nbsp;&nbsp;&nbsp;&nbsp;";
                        htmlstr += "<span class='edelete' title='Delete' ";
                        htmlstr += "onclick=\"DeleteField("+tabid+","+fid+",";
                        htmlstr += "'"+tabname+"', '"+fname+"')\">✘</span>";
                        htmlstr += "</li>";
                    }
                    htmlstr += "</ul>";
                    var odbfields = document.getElementById('dbfields');
                    odbfields.innerHTML = htmlstr;
                }
            }
            //List/View Fields
            function ViewTable(tabid)
            {
                var xmlHttp = null;

                if(tabid >= 0 && (xmlHttp = CreateXMLHTTP()) != null)
                {
                    var argv = "op=table_view&tableid="+tabid;
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                ViewFields(xmlHttp.responseText);
                            }
                        }
                    }
                    xmlHttp.send(argv);
                }
            }
            //List Tables
            function ListTables()
            {
                var xmlHttp = null;
                if((xmlHttp = CreateXMLHTTP()) != null)
                {
                    var argv = "op=table_list";
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                ViewDB(xmlHttp.responseText);
                            }
                        }
                    }
                    xmlHttp.send(argv);
                }
            }
            function HiddenDBform()
            {
                var div = document.getElementById('dbform');
                div.style.display = 'none';
                return true;
            }
            function DBXAdd(e)
            {
                e = e || window.event;
                var element = e.target || e.srcElement;
                var x = e.clientX + document.body.scrollLeft;
                var y = e.clientY + document.body.scrollTop;
                var Xdiv =  document.getElementById("dbform");
                Xdiv.style.left = x;
                Xdiv.style.top = y + 10;
                Xdiv.style.display = 'inline';
                var form = document.forms["xdbform"];
                form['op'].value = 'table_add';
                form['tableid'].value = '';
                form['name'].focus();
                form['name'].value = '';
            }
            function DBXEdit(e, id, name)
            {
                e = e || window.event;
                var element = e.target || e.srcElement;
                var Xdiv =  document.getElementById("dbform");
                var x = e.clientX + document.body.scrollLeft;
                var y = e.clientY + document.body.scrollTop;
                Xdiv.style.left = x - 50;
                Xdiv.style.top = y + 10;
                Xdiv.style.display = 'inline';
                var form = document.forms["xdbform"];
                form['op'].value = 'table_rename';
                form['tableid'].value = id;
                form['name'].focus();
                form['name'].value = name;
            }
            function EditDB(form)
            {
                if(form == null) return;
                var argv = null;
                var op = form['op'].value;
                var tableid = form['tableid'].value;
                var name = form['name'].value;
                if(op == 'table_add' && name)
                {
                    argv = "op=table_add&name="+name;
                }
                else if(op == 'table_rename' && tableid >= 0 && name)
                {
                    argv = "op=table_rename&tableid="+tableid+"&name="+name;
                }
                else if(op == 'table_delete' && tableid >= 0)
                {
                    argv = "op=table_delete&tableid="+tableid;
                }
                var xmlHttp = null;
                if(argv && (xmlHttp = CreateXMLHTTP()) != null)
                {
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                ViewDB(xmlHttp.responseText);
                            }
                        }
                    }
                    xmlHttp.send(argv);
                }
                return HiddenDBform();
            }
            function DBFXAdd(e, tabid)
            {
                e = e || window.event;
                var element = e.target || e.srcElement;
                var Xdiv =  document.getElementById("dbfieldform");
                var x = e.clientX + document.body.scrollLeft;
                var y = e.clientY + document.body.scrollTop;
                Xdiv.style.left = x - 50;
                Xdiv.style.top = y + 10;
                Xdiv.style.display = 'inline';
                var form = document.forms["dbfieldform"];
                form['op'].value = 'field_add';
                form['tableid'].value = tabid;
                form['fieldid'].value = '';
                form['oldname'].value = '';
                form['type'].value = '';
                form['flag'].value = '';
                form['is_index'].checked = false;
                form['is_null'].checked = false;
                form['name'].focus();
                form['name'].value = '';
            }
            function DBFXEdit(e, tabid, fieldid, fname, ftype, flag)
            {
                e = e || window.event;
                var element = e.target || e.srcElement;
                var Xdiv =  document.getElementById("dbfieldform");
                var x = e.clientX + document.body.scrollLeft;
                var y = e.clientY + document.body.scrollTop;
                Xdiv.style.left = x - 50;
                Xdiv.style.top = y + 10;
                Xdiv.style.display = 'inline';
                var form = document.forms["dbfieldform"];
                form['op'].value = 'field_update';
                form['tableid'].value = tabid;
                form['fieldid'].value = fieldid;
                form['oldname'].value = fname;
                form['type'].value = ftype;
                form['flag'].value = flag;
                form['is_index'].checked = false;
                form['is_null'].checked = false;
                for(i = 0; i < form['ftype'].options.length; i++)
                {
                    if(form['ftype'].options[i].value == ftype)
                        form['ftype'].options[i].selected = true;
                    else 
                        form['ftype'].options[i].selected = false;
                }
                if(flag & 1) form['is_index'].checked = true;
                if(flag & 2) form['is_null'].checked = true;
                form['name'].focus();
                form['name'].value = fname;
            }
            function HiddenDBFieldform()
            {
                var div = document.getElementById('dbfieldform');
                div.style.display = 'none';
                return true;
            }
            function EditField(form)
            {
                if(form == null) return;
                var argv = null;
                var op = form['op'].value;
                var tableid = form['tableid'].value;
                var fieldid = form['fieldid'].value;
                var fname = form['name'].value;
                var ftype = form['ftype'].value;
                var oldname = form['oldname'].value;
                var oldtype = form['type'].value;
                var oldflag = form['flag'].value;
                var flag = 0;
                if(op == 'field_add' && tableid >= 0 && fname && ftype > 0)
                {
                    argv = "op=field_add&tableid="+tableid+"&name="+fname+"&type="+ftype;
                    if(form['is_index'].checked == true) flag |= 1;
                    if(form['is_null'].checked == true) flag |= 2;
                    if(flag > 0) argv += "&flag="+flag;
                }
                else if(op == 'field_update' && tableid >= 0 && fieldid >= 0) 
                {
                    var eargv = "";
                    if(fname && fname != oldname) eargv += "&name="+fname;
                    if(form['is_index'].checked == true) flag |= 1;
                    if(form['is_null'].checked == true) flag |= 2;
                    if(ftype != oldtype) eargv += "&type="+ftype;
                    if(flag != oldflag) eargv += "&flag="+flag;
                    if(eargv)
                        argv = "op=field_update&tableid="+tableid+"&fieldid="+fieldid+eargv;
                }
                var xmlHttp = null;
                if(argv && (xmlHttp = CreateXMLHTTP()) != null)
                {
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                ViewFields(xmlHttp.responseText);
                            }
                        }
                    }
                    xmlHttp.send(argv);
                }
                return HiddenDBFieldform();
            }
            function DeleteField(tabid, fieldid, tabname, fieldname)
            {
                if(confirm("Are you sure delete Table:"+tabname+" Field:"+fieldname+"?") 
                    && (xmlHttp = CreateXMLHTTP()) != null)
                {
                    var argv = "op=field_delete&tableid="+tabid+"&fieldid="+fieldid;
                    xmlHttp.open('POST', '/', true);
                    xmlHttp.setRequestHeader("Content-Length", argv.length);
                    xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xmlHttp.onreadystatechange=function()
                    {
                        if(xmlHttp.readyState==4)
                        {
                            if(xmlHttp.status == 200)
                            {
                                ViewFields(xmlHttp.responseText);
                            }
                        }
                    }
                    xmlHttp.send(argv);
                }
                return true;
            }

            //database
            function selectView(div, e)
            {
                var elist = new Array('taskinfo','database', 'treebody', 'dns', 'proxy');
                e = e || window.event;
                var element = e.target || e.srcElement;
                var oli = null, ob = null, odiv = null;
                for(i = 0; i < elist.length; i++)
                {
                    if((oli = document.getElementById('tab'+i)))
                    {
                        if(oli == element)
                            oli.className = 'tab-selected';
                        else 
                            oli.className = '';
                    }
                    if(div == elist[i])
                    {
                        ob = document.getElementById(elist[i]);
                        ob.style.display = 'inline';
                    }
                    else
                    {
                        odiv = document.getElementById(elist[i]);
                        odiv.style.display = 'none';
                    }
                }
                if(div == 'database')
                {
                    var odb = document.getElementById('dbselect');
                    if(odb.innerHTML == '')
                    {
                        ListTables();
                    }
                }
                else if(div == 'treebody' && ob.innerHTML == '')
                {
                        AddNode(-1,0,"Root",0);
                        Fold(document.getElementById('fold_0'));
                }
                else if(div == 'dns' && ob.innerHTML == '')
                {
                        
                }
                else if(div == 'proxy' && ob.innerHTML == '')
                {
                }
            }
            function loadInit()
            {
                var otaskinfo = document.getElementById('taskinfo');
                otaskinfo.style.display = 'inline';
                ViewTask('task_view');
                window.setInterval("ViewTask('task_view')", 10000);
            }
        </script>
    </head>
    <body onload='javascript:loadInit();'>
    <div id='mainframe'>
    <div id='itab'>
        <ul>
        <li class='tab-selected' id='tab0' onclick="selectView('taskinfo',event)" >Task</li>
        <li id='tab1' onclick="selectView('database',event)" >DataBase</li>
        <li id='tab2' onclick="selectView('treebody', event)" >TreeNode</li>
        <li id='tab3' onclick="selectView('dns', event)" >DNS</li>
        <li id='tab4' onclick="selectView('proxy', event)" >Proxy</li>
        <div class="cleard"></div>
        </ul>
    </div>
    <div id='taskinfo'></div>
    <div id='database'>
        <div id='dbtitle'><span class='eadd' title='Add' onclick='DBXAdd(event)'>✚</span></div>
        <div id='dbselect'></div>
        <div id='dbfields'></div>
    </div>
    <div id='dns'></div>
    <div id='proxy'></div>
    <div id='treebody' level='0'></div>
    <div id='txtform' class='formdiv'>
        <form name="editorform" action="javascript:void(0)" onsubmit="return EditNode(this);"> 
            <input type=hidden name='op' value='node_add' >
            <input type=hidden name='nodeid' value='0' >
            <input type=hidden name='pid' value='0' >
            <input type='text' name='nodename' class='txtinput' size=16>
            <input type=submit value='ok' class='submit' >
            &nbsp;&nbsp;<span class='formclose' onclick="CloseForm(this)">x</span>
        </form>
    </div>
    <div id='dbform' class='formdiv'>
        <form name="xdbform" action="javascript:void(0)" onsubmit="return EditDB(this);"> 
            <input type=hidden name='op' value='table_add' >
            <input type=hidden name='tableid' value='0' >
            <input type='text' name='name' class='txtinput' size=16>
            <input type=submit value='ok' class='submit' >
            &nbsp;&nbsp;<span class='formclose' onclick="CloseForm(this)">x</span>
        </form>
    </div>
    <div id='dbfieldform' class='formdiv'>
        <form name="dbfieldform" action="javascript:void(0)" onsubmit="return EditField(this);"> 
            <input type=hidden name='op' value='table_add' >
            <input type=hidden name='tableid' value='' >
            <input type=hidden name='fieldid' value='' >
            <input type=hidden name='oldname' value='' >
            <input type=hidden name='type' value='' >
            <input type=hidden name='flag' value='' >
            Name:<input type='text' name='name' class='txtinput' size=16>
            &nbsp;&nbsp;
            Type:<select name='ftype' >
                <option value='1'>INT</option>
                <option value='2'>Double</option>
                <option value='4' selected>Text</option>
            </select>
            &nbsp;&nbsp;
            <input type=checkbox name='is_index' value=1 >Index
            <input type=checkbox name='is_null' value=4 >Null
            <input type=submit value='ok' class='submit' >
            &nbsp;&nbsp;<span class='formclose' onclick="CloseForm(this)">x</span>
        </form>
    </div>
    </div>
    <script language='javascript'>
    //ViewTask('task_view');
    //window.setInterval("ViewTask('task_view')", 10000);
    /*
    var levels = 0;
    function addnodes(pid)
    {
        var i = 0, id = 0;
        for(i = 1; i < 10; i++)
        {
            id = pid * 10 + i;
            AddNode(pid, id, "node"+id);
        }
    }
    addnodes(0);
    */
    /*
    alert(document.getElementById('treebody').innerHTML);
    document.write("<pre>");
    document.write(dxtree.TreeList);
    document.write("</pre>");
    */
</script>
</body>
</html>
