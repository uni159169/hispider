<html>
    <head>
        <title>Check Box Tree</title>
        <style>
            body{margin:0px;}
            .line{position:absolute;display:none;background-color:#3366cc;color:#ffffff;}
            .title{border:0px;font-size:16px;background-color:#777;}
            .btitle{border:0px;font-size:16px;background-color:#C0D9D9;}
            .node{padding-left:30px;overflow:hidden;background-color:#3366cc;}
            .icon{display:inline;margin-right:5px;cursor:pointer;}
        </style>
    <script language='javascript'>
    function FindArr(arr, v)
    {
        var i = 0;
        do
        {
            if(arr[i] == v) 
            return i;
        }while(++i < arr.length);
        return -1;
    }
    function DelArr(arr, v)
    {
        var i = 0;
        do
        {
            if(arr[i] == v) 
            {
                arr.splice(i, 1);
                return i;
            }
        }while(++i < arr.length);
        return -1;
    }
    function ReplaceArr(arr, v, newv)
    {
        var i = 0;
        do
        {
            if(arr[i] == v) 
            {
                arr[i] = newv;
                return i;
            }
        }while(++i < arr.length);
        return -1;
    }
    function highlight(obj)
    {
        obj.className = "btitle";
    }
    function backcss(obj)
    {
        obj.className = "title";
    }
    xtree = function(rootid)
    {
        this.TreeNodeNum = 0;
        this.TreeList = new Array();
        this.Root = document.getElementById(rootid);
        //node array p[] = {0/n(nchilds), parentid, level, name, childs};
        //add node
        this.Add = function(pid, name)
        {
            var pnode = null;
            var node = new Array();
            var id = -1;
            if(pid >= 0) pnode = this.TreeList[pid];
            if(pnode == null || pnode[0] == 0 || (pnode[0] > 0 && FindArr(pnode[4], name) == -1))
            {
                node[0] = 0;
                node[1] = pid;
                if(pnode)node[2] = pnode[2] + 1;
                else node[2] = 0;
                node[3] = name;
                node[4] = new Array();
                node[5] = new Array();
                this.TreeList.push(node);
                id = (this.TreeNodeNum)++;
                if(pnode)
                {
                    pnode[4].push(name);
                    pnode[5].push(id);
                    pnode[0]++;
                }
            }
            return id;
        }

        //remove node
        this.Remove = function(cid)
        {
            var node = false;
            var pnode = false;
            var i = 0, pid = 0;

            if((node = this.TreeList[cid]))
            {
                if((pid = node[1]) && (pnode = this.TreeList[pid]))
                {
                    DelArr(pnode[4], node[3]);
                    DelArr(pnode[5], cid);
                    pnode[0]--;
                }
                for(i = 0; i < node[0]; i++)
                {
                    this.Remove(node[0][i]);
                }
                this.TreeList[cid] = "";
            }
        }
        //update 
        this.Update = function(cid, name)
        {
            var node = false;
            var pnode = false;
            var pid = 0;

            if((node = this.TreeList[cid]))
            {
                if((pid = node[1]) && (pnode = this.TreeList[pid]))
                {
                    ReplaceArr(pnode[4], node[3], name);
                }
                node[3] = name;
            }
        }
        //add node
        this.AddNode = function(pid, id, name)
        {
            //nodeid = this.Add(pid, name);
            //if(nodeid < 0) return ;
            var oParent = null;
            if(pid >= 0)
            {
                oParent = document.getElementById("node"+pid);
            }
            else
            {
                oParent = this.Root;//document.getElementById(this.RootId);
            }
            if(oParent == null) return;
            var oNode = document.createElement('div');
            oNode.id = "node" + id;
            oNode.className = 'node';
            var htmlstr = "";
            /*
            var node = this.TreeList[nodeid];
            var i = 0;
            for(i = 0; i < node[2]; i++)
            {
                htmlstr += "";//â”†&nbsp;&nbsp;&nbsp;&nbsp;";
            }
            */
            htmlstr += "<div id='title_"+ id +"' class='title' ";
            htmlstr += " onmousemove='highlight(this);' onmouseout='backcss(this);'>";
            htmlstr += "<span class='icon' onclick='Fold(this)'>-</span>";
            htmlstr += "<input type=checkbox name='chk"+ id +"' value='"+ id +"'>"+ name +"</div>";
            oNode.innerHTML = htmlstr; 
            oParent.appendChild(oNode);
        }

        //drop node
        this.DropNode = function(id)
        {
            this.Remove(id);
            var oNode = document.getElementById("node"+id);
            oNode.innerHTML = ""; 
        }
        //init root
        this.init = function(name)
        {
            this.AddNode(-1, 0, name);
        }
    }
    function Fold(element)
    {
        if(element.innerText == '+')
        {
            element.parentNode.parentNode.style.height = '';
            element.innerText = '-';
        }
        else
        {
            element.innerText = '+';
            element.parentNode.parentNode.style.height = element.parentNode.offsetHeight;
        }
    }
    </script>
    </head>
    <body>
    <form action="#" ><div id='treebody' ></div></form>
    <script language='javascript'>
    var dxtree = new xtree('treebody');
    dxtree.init("OK");
    var i = 0, j = 0, k = 0; x = 0, z = 0;
    for(i = 1; i < 10; i++)
    {
        dxtree.AddNode(0, i, "node"+i);
        for(j = 0; j < 10; j++)
        {
            x = i * 10 + j;
            dxtree.AddNode(i, x, "node" + x);
            for(k = 0; k < 10; k++)
            {
                z = k * 100 + i * 10 + k;
                dxtree.AddNode(x, z, "node" + z);
            }
        }
    }
    /*
    document.write("<pre>");
    document.write(dxtree.TreeList);
    document.write("</pre>");
    */
</script>
</body>
</html>
